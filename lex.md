# JavaScript 标准 ECMA-262 (2026) 词法规范

### 1. JS 字符集与编码

JS 源码默认采用 UTF-8 编码，支持 ASCII 和 Unicode 字符（如中文标识符、表情符号）。  
空白符（Whitespace）包括空格（）、制表符（\t）、换行（\n）、回车（\r）、Unicode 空白符（如\u00A0）等，用于分隔 Token，默认被跳过。  
行终止符（LineTerminator）\n、\r、\r\n、\u2028（行分隔符）、\u2029（段分隔符），用于触发 ASI，需在词法分析中记录位置。  

### 2. Token 分类

|类别   | 示例                      |说明   |
|---|-------------------------|---|
|注释（Comments）   | // 单行注释、/* 多行注释 */      |单行注释到行终止符结束，多行注释可跨行   |
|关键字（Keywords）   | function、let、if、async等  |固定字符串，需优先匹配   |
|标识符（Identifiers）   | foo、_bar、$baz、中文变量      |可包含 Unicode 字母、$、_、数字（非开头）   |
|字面量（Literals）   | 42、3.14、"abc"、/a/g、true |数字、字符串、正则、布尔值、null等   |
|运算符与标点（Punctuators）   | +、=>、===、{、;            |含单字符和多字符（如++、>>=），长匹配优先   |
|模板字符串（TemplateLiterals）   | \`hello ${x}\`          |反引号包裹，含插值${}，需单独处理   |

Token 需按“长匹配优先、关键字优先于标识符”的原则处理。  

### 3. 词法规则

#### (1). 跳过空白符和注释

空白符和注释不生成 Token，需优先处理。

##### 空白符

* 正则规则（含 Unicode 空白符）：
```regexp
[ \t\v\f\u00A0\u2000-\u200A\u202F\u205F\u3000]
```
* 处理逻辑：直接跳过（continue），不记录。

##### 行终止符

* 正则规则：
```regexp
\n | \r\n? | [\u2028\u2029]
```
* 处理逻辑：记录行号（供 ASI 使用），然后跳过。

##### 注释

* 单行注释（//）：从//到行终止符结束，正则：
```regexp
"//" [^\n\r\u2028\u2029]*
```
* 多行注释（/* */）：可跨行，不能嵌套，正则：
```regexp
"/\*" ([^*]|\*+[^*/])*\*+ "/"
```
* 处理逻辑：跳过，不生成 Token。

#### (2). 匹配关键字

关键字是固定字符串，必须优先于标识符匹配。核心关键字：
```
break   case    catch   class   const   continue  debugger  default
delete  do      else    export  extends false     finally   for
function if      import  in      instanceof let     new       null
return  super   switch  this    throw   true      try       typeof
var     void    while   with    yield   async     await
```

* 正则规则（用|分隔所有关键字）：
```regexp
"break" | "case" | "catch" | ... | "async" | "await"
```
* null、true、false是字面量关键字，需归为关键字类别（而非字面量），避免被识别为标识符。

#### (3). 匹配标识符

标识符是变量名、函数名等，支持 Unicode 字符

##### 规则定义

* 首字符（IdentifierStart）：字母（a-z, A-Z）、$、_、Unicode 字母。
* 后续字符（IdentifierPart）：首字符 + 数字（0-9）、Unicode 数字、Unicode 连接符。  
* 正则规则（简化版）：
```regexp
[\p{Letter}$_][\p{Letter}\p{Number}$_\u200C\u200D]*
```

##### 特殊情况

* 保留字（Reserved Words）：如enum、implements，虽不能作为标识符，但词法分析阶段仍识别为标识符（语义分析阶段报错），无需在词法规则中特殊处理。
* ES6 + 的私有标识符：如#foo，首字符为#，需单独匹配：
```regexp
"#" [\p{Letter}$_][\p{Letter}\p{Number}$_\u200C\u200D]*
```

#### (4). 匹配字面量

字面量是直接在代码中书写的值，规则最复杂，需按长匹配优先处理。

##### 数字字面量

支持十进制、二进制、八进制、十六进制，以及科学计数法。

* 正则规则（分类型匹配，避免歧义）：
```regexp
// BigInt 字面量（优先级最高，避免被拆分为数字+标识符）
// 二进制 BigInt: 0b/0B + 0-1 + n
0[bB][01]+n
// 八进制 BigInt: 0o/0O + 0-7 + n
| 0[oO][0-7]+n
// 十六进制 BigInt: 0x/0X + 0-9/a-f/A-F + n
| 0[xX][0-9a-fA-F]+n
// 十进制 BigInt: 0n 或 非0开头的数字 + n（无前导零）
| (0n)|([1-9][0-9]*n)

// 普通数字字面量
| 0[bB][01]+
| 0[oO][0-7]+
| 0[xX][0-9a-fA-F]+
| ([0-9]+\.[0-9]*|\.[0-9]+|[0-9]+)([eE][+-]?[0-9]+)?
```

##### 字符串字面量

支持单引号（'）、双引号（"）、反引号（`，模板字符串），以及转义字符。

* 普通字符串（单 / 双引号）：
```regexp
// 双引号字符串：支持转义字符（如 \"、\n）
"\"([^\"\\]|\\([btnfr\"'\\/]|u[0-9a-fA-F]{4}|u\{[0-9a-fA-F]+\}))*\""
// 单引号字符串（逻辑同上）
| "'([^'\\]|\\([btnfr\"'\\/]|u[0-9a-fA-F]{4}|u\{[0-9a-fA-F]+\}))*'"
```

* 模板字符串：  
使用反引号（`）包裹，支持内嵌表达式插值（${...}）。由于插值内部可包含任意合法 JS 表达式（包括嵌套模板字符串），无法通过单一正则表达式完整匹配，必须采用状态机或递归下降方式处理。

##### 正则字面量

可能与除法符号（/）产生歧义，需结合前一个 Token判断。

* 匹配条件：当前一个 Token 是以下类型时，/为正则开头（否则为除法运算符）：
    * 关键字：break、return、throw等（如return /a/）。
    * 标点：(、[、{、;、,、=、:等（如let a = /a/）。
    * 无前一个 Token（源码开头）。
* 正则规则（简化版，忽略复杂模式）：
```regexp
"/([^/\\]|\\.)*/[gimuy]*"
```
* 处理逻辑：在词法分析器中维护前一个 Token 类型，当满足上述条件时，匹配正则字面量；否则匹配除法运算符。

##### 布尔值与 null

归为关键字，优先匹配。
```regexp
"true" | "false" | "null"
```

#### (5). 匹配运算符与标点

包含单字符和多字符运算符，需按长匹配优先顺序匹配。核心列表：
```
// 多字符运算符（优先匹配）
===  !==  ==  !=  >=  <=  >>=  >>>=  <<=  +=  -=  *=  /=  %=  &=  |=  ^=
&&  ||  ++  --  <<  >>  >>>  &  |  ^  &&  ||  ?  :  =>  ...  ..

// 单字符运算符与标点
+  -  *  /  %  =  !  ~  <  >  (  )  [  ]  {  }  ;  ,  .  ?  :  `  @  #
```

正则规则（多字符在前，单字符在后）：
```regexp
"===" | "!==" | "==" | "!=" | ">=" | "<=" | "=>" | "..." | "++" | "--" | ... 
| "+" | "-" | "*" | "/" | "%" | "=" | "!" | ... | "(" | ")" | "{" | "}" | ";" | ","
```